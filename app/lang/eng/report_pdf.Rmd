---
title: "COVID-19 Acute and Intensive Care Resource Tool"
subtitle: "CAIC-RT: General Report"
date: "__Report Generated:__ `r paste0(Sys.Date())`"
output: pdf_document
geometry: margin=2cm
fontsize: 10pt
subparagraph: true
header-includes:
  - \usepackage{tcolorbox}
  - \usepackage{titling}
  - \usepackage{titlesec}
  - \usepackage{setspace}
  - \usepackage{float}
  - \usepackage{booktabs}
  - \pretitle{\begin{flushleft}\LARGE \vskip -3em\textsf \textsc}
  - \posttitle{\end{flushleft}}
  - \predate{\begin{flushleft}}
  - \postdate{\end{flushleft}}
  - \renewcommand{\familydefault}{\sfdefault}
params:
  widgets: NULL
  table: NULL
  outputs: NULL
  plot: NULL
---

\pagenumbering{gobble}

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo=FALSE, 
  error = TRUE, 
  message = FALSE, 
  warning = FALSE,
  out.width = "80%"
  )

library(tidyverse)
library(scales)
library(glue)
library(knitr)
library(kableExtra)
```

\begin{tcolorbox}[title=Tool Information, colback=white]
\textbf{Authors:}
\begin{itemize}
  \item{Vasily Giannakeas, MPH \textsuperscript{1,2}}
  \item{Deepit Bhatia, MPH}
  \item{Matthew T. Warkentin, MSc \textsuperscript{2,3}}
  \item{Isaac I. Bogoch, MD \textsuperscript{4,5}}
  \item{Nathan M. Stall, MD \textsuperscript{1,4,6,7}}
\end{itemize}
\medskip

\textbf{Description:} CAIC-RT is an online tool capable of estimating the maximum daily number of incident COVID-19 cases that a healthcare system could manage based on age-based case distribution and severity, and the number of available acute and critical care resources.

\medskip
{\tiny\begin{singlespace}
1. Women's College Research Institute, Women's College Hospital, Toronto, Ontario, Canada, 2. Dalla Lana School of Public Health, University of Toronto, Toronto, Ontario, Canada, 3. Lunenfeld-Tanenbaum Research Institute, Sinai Health System, Toronto, Ontario, Canada, 4. Department of Medicine, University of Toronto, Toronto, Ontario, Canada, 5. Divisions of General Internal Medicine and Infectious Diseases, University Health Network, Toronto, Canada, 6. Institute of Health Policy, Management and Evaluation, University of Toronto, Toronto, Ontario, Canada, 7. Divisions of General Internal Medicine and Geriatrics, Sinai Health System, Toronto, Ontario, Canada
\end{singlespace}}
\end{tcolorbox}

```{r}
knitr::asis_output('\\begin{tcolorbox}[title=Customizable Inputs, colback=white]')
```

```{r widget-inputs, include=FALSE}
n_acute <- params$widgets$n_acute
n_crit <- params$widgets$n_crit
n_vent <- params$widgets$n_vent
lou_acute <- params$widgets$lou_acute
lou_crit<- params$widgets$lou_crit
lou_vent <- params$widgets$lou_vent
per_vent <- params$widgets$per_vent
```

```{r}
tribble(
  ~item, ~value,
  "Mean days in acute care", lou_acute,
  "Mean days in critical care", lou_crit,
  "Mean days on a mechanical ventilator", lou_vent
) %>% 
  kable(booktabs = TRUE, format.args = list(big.mark = ','),
        format = 'latex',
        caption = "Expected resource utilization for COVID-19 patients.",
        col.names = c('Input Parameter', 'Value')) %>% 
  kable_styling(full_width = FALSE, position = 'center', latex_options = 'H') %>% 
  row_spec(0, bold = TRUE)
```

```{r}
tribble(
  ~item, ~value,
  "Number of acute care beds", n_acute,
  "Number of critical care beds", n_crit,
  "Number of mechanical ventilators", n_vent,
  "Percent patients requiring mechanical ventilation", per_vent
) %>% 
  kable(booktabs = TRUE, format.args = list(big.mark = ','),
        format = 'latex',
        caption = "Resource availability for COVID-19 patients.",
        col.names = c('Input Parameter', 'Value')) %>% 
  kable_styling(full_width = FALSE, position = 'center', latex_options = 'H') %>% 
  row_spec(0, bold = TRUE)
```

```{r}
kable(params$table, booktabs = TRUE, 
      format = 'latex',
      col.names = c('Age groups',
                    'Case Distribution (%)',
                    'Acute Care Admission (%)',
                    'Critical Care Admission (%)'), 
      caption = "Age-stratified case distribution and severity.") %>% 
  kable_styling(full_width = FALSE, 
                position = 'center', latex_options = 'H') %>% 
  row_spec(0, bold = TRUE)
```

```{r}
knitr::asis_output('\\end{tcolorbox}')
```

```{r}
knitr::asis_output('\\begin{tcolorbox}[title={Output - Maximum daily number of incident COVID-19 cases, by resource type}, colback=white]')
```

```{r plot, fig.align='center'}
params$plot + 
  theme(
    text = element_text(size = 14),
    axis.text.x = element_text(angle = 0)
  )
```

```{r}
knitr::asis_output('\\end{tcolorbox}')
```

```{r}
knitr::asis_output('\\begin{tcolorbox}[title=Interpretation, colback=white]')
```

```{r acute, results='asis'}
knitr::asis_output('\\textbf{Acute Care: }')
glue('Based on {format(params$outputs$acute$n_acute, big.mark = ",")} available acute care beds with an average length of stay of {params$outputs$acute$lou_acute} days, at maximum capacity the expected turnover rate is {format(floor(params$outputs$acute$acuteBedRate), big.mark = ",")} beds per day. Based on the age-stratified case distribution, the proportion of COVID-19 cases requiring an acute care bed is {round(params$outputs$acute$rateAcute, 1)} percent. Given this, your healthcare environment has the capacity to manage a maximum of {format(floor(params$outputs$acute$maxAcute), big.mark = ",")} incident cases of COVID-19 per day.')
```

```{r}
knitr::asis_output('\\bigskip')
```

```{r critical, results='asis'}
knitr::asis_output('\\textbf{Critical Care: }')
glue('Based on {format(params$outputs$crit$n_crit, big.mark = ",")} available critical care beds with an average length of stay of {params$outputs$crit$lou_crit} days, at maximum capacity the expected turnover rate is {format(floor(params$outputs$crit$critBedRate), big.mark = ",")} beds per day. Based on the age-stratified case distribution, the proportion of COVID-19 cases requiring a critical care bed is {round(params$outputs$crit$rateCrit, 1)} percent. Given this, your healthcare environment has the capacity to manage a maximum of {format(floor(params$outputs$crit$maxCrit), big.mark = ",")} incident cases of COVID-19 per day.')
```

```{r}
knitr::asis_output('\\bigskip')
```

```{r results='asis'}
knitr::asis_output('\\textbf{Mechanical Ventilators: }')
glue('Based on {format(params$outputs$mvent$n_vent, big.mark = ",")} available mechanical ventilators with an average duration of use of {params$outputs$mvent$lou_vent} days, at maximum capacity the expected turnover rate is {format(floor(params$outputs$mvent$ventBedRate), big.mark = ",")} ventilators per day. Based on the age-stratified case distribution, the proportion of COVID-19 cases requiring mechanical ventilation is {round(params$outputs$mvent$rateVent, 1)} percent. Given this, your healthcare environment has the capacity to manage a maximum of {format(floor(params$outputs$mvent$maxVent), big.mark = ",")} incident cases of COVID-19 per day.')
```

```{r}
knitr::asis_output('\\end{tcolorbox}')
```
